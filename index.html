<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Identidad de Territorio - Inspirando Calidad y Cultura</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding-top: 140px; /* espacio para header fijo (aumentado para logo m√°s grande) */
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            color: #333;
            line-height: 1.9;
        }
        header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 14px 20px; /* ligeramente m√°s compacto verticalmente */
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center; /* centra logo + t√≠tulo + nav */
            gap: 8px;
        }
        nav ul {
            list-style: none;
            padding: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        nav a:hover {
            color: #FFD700;
        }
        .hero {
            min-height: calc(100vh - 120px); /* ajustar al header */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: url('https://source.unsplash.com/featured/?landscape,fruit,tree,technology') no-repeat center/cover;
            color: white;
            position: relative;
            padding: 40px 0;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        .hero div {
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }
        .hero h1 {
            font-size: 3em;
            margin-bottom: 20px;
            animation: fadeIn 2s;
        }
        .hero p {
            font-size: 1.5em;
            margin-bottom: 30px;
        }
        .btn {
            background: #FFD700;
            color: #333;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #FFA500;
        }
        /* p√°rrafos fuera de los recuadros: centrados y con color claro para contraste */
        section > p {
            color: #cfeeff; /* azul claro legible sobre el fondo verde/azul */
            text-shadow: 0 1px 0 rgba(255,255,255,0.25);
            margin: 0 auto 26px;
            max-width: 1100px; /* alinear con el ancho de las tarjetas */
            text-align: center;
            font-size: 1.05em;
        }
        .section-title {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 60px;
            color: #FFD700;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 24px auto; /* centrar con margen autom√°tico */
            max-width: 1100px; /* limitar ancho para respiraci√≥n visual */
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-10px);
        }
        .slider {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 24px;
            padding: 20px 0;
        }
        .slider-item {
            flex: 0 1 320px;
            max-width: 340px;
            background: #f4f4f4;
            padding: 22px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
        }
        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 20px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Acordeones: alinear con las cards (mismo max-width) y justificar contenido a la izquierda */
        .accordion {
            background: transparent;
            border: none;
            margin: 16px auto;
            max-width: 1100px; /* mismo ancho que .card */
        }
        .accordion-header {
            background: #2196F3;
            color: white;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 6px;
            text-align: left; /* encabezado a la izquierda */
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .accordion-header::after {
            content: "\25B8"; /* small triangle pointing right */
            float: right;
            transition: transform 0.2s ease;
        }
        .accordion-header.open::after {
            content: "\25BE"; /* small triangle pointing down */
        }
        /* Smooth open/close using max-height; JS ajusta maxHeight para el contenido */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.45s cubic-bezier(.2,.8,.2,1), opacity 0.3s ease, padding 0.3s ease;
            padding: 0; /* el contenido interno puede a√±adir su propio padding */
            opacity: 0;
            background: transparent;
        }
        .accordion .card-like {
            background: white;
            border-radius: 8px;
            padding: 14px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.08);
            /* allow internal scrolling when content is taller than viewport */
            max-height: 70vh;
            overflow: auto;
        }
        /* For embedded forms, keep iframe full width of the constrained container and fill available height */
        .accordion iframe {
            width: 100%;
            border: none;
            height: 100%;
            min-height: 300px;
            display: block;
        }

        /* container to align action buttons with cards */
        .action {
            max-width: 1100px;
            margin: 16px auto;
            text-align: center; /* change to left if you prefer left-justified */
        }
        .action.left { text-align: left; }
        .btn { display: inline-block; }

        /* Watermark / marca de fondo (SVG ligero, baja opacidad) */
        .watermark {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 60vw;
            max-width: 900px;
            opacity: 0.06;
            z-index: 0;
            pointer-events: none;
        }
    .watermark-img { width:100%; height:auto; display:block; filter: saturate(0.95); }
    /* Header branding: logo centrado y m√°s visible */
    .header-logo { position: static; height: 88px; width: auto; display: block; margin: 4px auto 0; z-index: 110; }
    header h1 { margin: 6px 0 0; font-size: 1.25rem; line-height: 1.1; }

        /* Responsiveness: ajustar tipograf√≠as y paddings en pantallas peque√±as */
        @media (max-width: 800px) {
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
            .card { padding: 18px; }
            .accordion-header { padding: 10px 14px; }
            .accordion iframe { min-height: 220px; }
            .section-title { font-size: 1.6em; margin-bottom: 32px; }
            /* Reduce internal card max-height on small screens to keep forms usable */
            .accordion .card-like { max-height: 60vh; }
            
            /* Optimizaci√≥n header m√≥vil: m√°s compacto y logo m√°s grande */
            body { padding-top: 80px; } /* reducir padding para que header ocupe menos espacio */
            header { 
                padding: 8px 16px; 
                gap: 4px; 
                min-height: 70px; /* altura fija m√°s compacta */
            }
            .header-logo { 
                height: 45px; /* logo m√°s grande y visible */
                margin: 2px auto 0;
            }
            header h1 { 
                font-size: 0.9rem; 
                margin: 2px 0 4px;
                line-height: 1;
            }
            nav ul { 
                gap: 12px; 
                flex-wrap: wrap;
                justify-content: center;
                margin: 0;
                padding: 0;
            }
            nav a { 
                font-size: 0.85rem; 
                padding: 2px 4px;
            }
            
            /* Centrado robusto para m√≥vil en todos los niveles de zoom */
            section, .hero {
                padding-left: 10px;
                padding-right: 10px;
            }
            
            .card, .accordion, .action, .slider {
                max-width: calc(100vw - 20px);
            }
            
            .section-title {
                width: 100%;
                text-align: center;
                margin-left: auto;
                margin-right: auto;
            }
        }
        
        /* Media query espec√≠fica para vista horizontal en m√≥vil */
        @media (max-width: 900px) and (max-height: 500px) {
            /* Header ultra-compacto para landscape */
            body { padding-top: 45px !important; }
            header { 
                padding: 4px 12px !important;
                gap: 2px !important;
                min-height: 40px !important;
                flex-direction: row !important;
                justify-content: space-between !important;
            }
            .header-logo { 
                height: 32px !important;
                margin: 0 !important;
                flex-shrink: 0;
            }
            header h1 { 
                font-size: 0.7rem !important;
                margin: 0 8px !important;
                line-height: 1 !important;
                flex-grow: 1;
                text-align: left;
            }
            nav ul { 
                gap: 8px !important;
                margin: 0 !important;
                flex-wrap: nowrap !important;
            }
            nav a { 
                font-size: 0.7rem !important;
                padding: 1px 3px !important;
            }
            .hero {
                min-height: calc(100vh - 50px) !important;
                padding: 20px 0 !important;
            }
            .hero h1 { font-size: 1.5rem !important; }
            .hero p { font-size: 0.9rem !important; }
        }
        
        .card, .accordion, .action, .slider {
            margin-left: auto;
            margin-right: auto;
        }
        

        
        /* Soluci√≥n espec√≠fica SOLO para zoom m√≥vil - no afecta PC */
        @media screen and (max-width: 800px) and (max-device-width: 800px) {
            @supports (-webkit-overflow-scrolling: touch) {
                /* Solo en dispositivos t√°ctiles m√≥viles */
                html {
                    width: 100%;
                    overflow-x: hidden;
                }
                
                body {
                    min-width: 100%;
                    overflow-x: hidden;
                }
                
                /* Centrado espec√≠fico para zoom out SOLO en m√≥vil */
                .card, .accordion, .action, .slider, .section-title {
                    position: relative;
                    left: 50%;
                    transform: translateX(-50%);
                    width: calc(100vw - 20px);
                    max-width: 1100px;
                }
            }
        }
        
        /* Modal fullscreen for forms */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }
        .modal-overlay.open { display:flex; }
        .modal-content {
            width: 100%;
            max-width: 1100px;
            height: 90vh;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .modal-close {
            position: absolute;
            right: 12px;
            top: 12px;
            background: rgba(0,0,0,0.6);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 2;
        }
        .modal-content iframe { width:100%; height:100%; border:none; }
        /* asegurar que el contenido est√© por encima de la marca de agua */
        section, .card, footer {
            position: relative;
            z-index: 2;
        }
    </style>
</head>
<body>
    <!-- Marca de agua SVG: baja opacidad, centrada como fondo decorativo -->
    <div class="watermark" aria-hidden="true">
        <!-- Marca de agua: usar el logo proporcionado por el usuario -->
        <img src="logo.png" alt="Identidad de Territorio logo" class="watermark-img">
    </div>
    <header>
        <img src="logo.png" alt="Logo Identidad de Territorio" class="header-logo">
        <h1>Identidad de Territorio</h1>
        <nav>
            <ul>
                <li><a href="#identidad">Identidad</a></li>
                <li><a href="#exportacion">Exportaci√≥n</a></li>
                <li><a href="#cultura">Cultura</a></li>
                <li><a href="#servicios">Servicios</a></li>
                <li><a href="#trials">Trials</a></li>
                <li><a href="#roi">ROI</a></li>
                <li><a href="#consulta">Consulta</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div>
            <h1>¬øTu Producto se Confunde con la Competencia?</h1>
            <p><strong>Convierte tu marca en Premium Internacional</strong> con nuestra metodolog√≠a √∫nica: Cine + Software que certifica calidad, optimiza procesos de exportaci√≥n y abre nuevos mercados globales.</p>
            <a href="#servicios" class="btn">Ver C√≥mo Funciona</a>
        </div>
    </section>

    <section id="identidad">
        <h2 class="section-title">Tu Marca Tiene Historia - Nosotros la Contamos</h2>
        <p><strong>REALIDAD:</strong> Tu producto de calidad se pierde entre commodities sin diferenciaci√≥n. <strong>OPORTUNIDAD:</strong> Convertimos tu origen y procesos en una narrativa premium que justifica valor superior.</p>
    <div class="card">
            <h3>üé¨ + üíª = Diferenciaci√≥n Aut√©ntica</h3>
            <p><strong>Posibilidad real:</strong> Empresas que desarrollan storytelling territorial abren oportunidades en mercados premium donde la historia importa tanto como la calidad.</p>
            <p><em>"Descubrimos que nuestro proceso artesanal era nuestro mayor activo de diferenciaci√≥n internacional"</em> - Empresario textil participante</p>
        </div>
    </section>

    <section id="exportacion">
        <h2 class="section-title">¬øPierdes Tiempo y Dinero en Auditor√≠as Infinitas?</h2>
        <p><strong>LA REALIDAD:</strong> Las inspecciones aduaneras pueden retrasar tus exportaciones hasta 3 semanas. <strong>NUESTRA PROPUESTA:</strong> Certificaci√≥n digital que puede agilizar procesos y validar origen.</p>
        <p><strong>Certificaci√≥n que Diferencia tu Marca:</strong> Certificado digital con QR que verifica origen y RSE, con potencial de optimizar inspecciones aduaneras y procesos. √önico por combinar emoci√≥n (cine) con precisi√≥n (software).</p>
        <div class="slider">
            <div class="slider-item">
                <h4>Diagn√≥stico Inicial</h4>
                <p>Evaluaci√≥n de procesos para asegurar est√°ndares de exportaci√≥n.</p>
            </div>
            <div class="slider-item">
                <h4>Sistemas de Trazabilidad</h4>
                <p>Aplicaciones dedicadas para certificaci√≥n de origen.</p>
            </div>
            <div class="slider-item">
                <h4>Mantenimiento Garantizado</h4>
                <p>Soporte continuo por 12 meses.</p>
            </div>
        </div>
    </section>

    <section id="cultura">
        <h2 class="section-title">Cultura Organizacional Integral</h2>
        <p>Social, ambiental y econ√≥mico. Asocia tu marca al legado art√≠stico y narrativo, apelando a la conciencia territorial.</p>
        <p><strong>Visibilidad Global:</strong> Distribuci√≥n en plataformas como YouTube y festivales (1M+ vistas estimadas). +50% engagement vs. anuncios est√°ndar, alcanzando 10 pa√≠ses con historias que diferencian tu marca como resiliente y premium.</p>
        <div class="card">
            <h3>Beneficios Emocionales</h3>
            <p>Inmortalizaci√≥n mediante cortometrajes, clips para RSE (Responsabilidad Social Empresarial) y m√°xima visibilidad global.</p>
            <div style="text-align: center;">
                <iframe width="560" height="315" src="https://www.youtube.com/embed/lWciuWN-Qmc" title="Misi√≥n de la Producci√≥n del Film" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </section>

    <section id="servicios">
        <h2 class="section-title">Gamas de Servicio para Patrocinadores</h2>
        <p>Ajustadas a niveles de patrocinio: Oro, Platino, Diamante. Elige tu l√≠nea: Emocional (Film), Log√≠stica/Digital (Software) o Integral (Combinado).</p>
        <div class="card">
            <h3>L√≠nea A: Posicionamiento Emocional</h3>
            <ul>
                <li><strong>Oro:</strong> Cr√©ditos y making-of (Entrevistas y Behind The Scenes BTS).</li>
                <li><strong>Platino:</strong> Emplazamiento en di√°logo, clips para RSE.</li>
                <li><strong>Diamante:</strong> "Presentado por [Marca]", licencia ilimitada.</li>
            </ul>
        </div>
        <div class="card">
            <h3>L√≠nea B: Posicionamiento Log√≠stico/Digital</h3>
            <ul>
                <li><strong>Oro:</strong> Diagn√≥stico y m√≥dulo piloto.</li>
                <li><strong>Platino:</strong> Desarrollo completo de trazabilidad.</li>
                <li><strong>Diamante:</strong> Soluci√≥n integral CRM/SGP.</li>
            </ul>
        </div>
        <div class="card">
            <h3>L√≠nea C: Posicionamiento Integral</h3>
            <ul>
                <li><strong>Diamante:</strong> M√°xima exposici√≥n emocional + software robusto + inversi√≥n compartida.</li>
            </ul>
        </div>
        <div class="action">
            <a href="#consulta" class="btn">Solicita Consulta</a>
        </div>
    </section>

    <section id="consulta">
        <h2 class="section-title">Solicita una Consulta Personalizada</h2>
        <p>¬øTienes preguntas sobre nuestros servicios, gamas o presupuestos? Haz clic para expandir el formulario.</p>
        <div class="accordion">
            <div class="accordion-header" role="button" tabindex="0" aria-controls="consulta-content" aria-expanded="false" onclick="toggleAccordion('consulta-content', this)">Formulario de Consulta Personalizada</div>
            <div id="consulta-content" class="accordion-content">
                    <div class="card-like">
                        <iframe id="iframe-consulta" title="Formulario de Consulta Personalizada" src="https://docs.google.com/forms/d/e/1FAIpQLSeolPYy8p-sjRD9HjXiHXArKyk_IKGJXUoJZJJLnI17WpIc1w/viewform?embedded=true" width="100%" frameborder="0" marginheight="0" marginwidth="0" style="height:100%">Cargando‚Ä¶</iframe>
                        <p style="font-size: 0.8em; color: #666;">Formulario para consultas. Recibir√°s una respuesta personalizada.</p>
                        <div style="margin-top:10px; text-align:right;">
                            <button class="btn" onclick="openFullscreenIframe('iframe-consulta','Formulario de Consulta Personalizada')">Abrir a pantalla completa</button>
                        </div>
                    </div>
            </div>
        </div>
    </section>

    <section id="trials">
        <h2 class="section-title">Pruebas Gratuitas para Niveles Bajos</h2>
        <p>Descubre nuestros servicios sin compromiso. Haz clic para expandir el formulario.</p>
        <div class="accordion">
            <div class="accordion-header" role="button" tabindex="0" aria-controls="trials-content" aria-expanded="false" onclick="toggleAccordion('trials-content', this)">Solicitar Trial (Film o Software)</div>
            <div id="trials-content" class="accordion-content">
                <div class="card-like">
                    <iframe id="iframe-trial" title="Formulario de Solicitud de Trial" src="https://docs.google.com/forms/d/e/1FAIpQLSch2exxZ8VMwwZoYtkMw0bCVWeosSEjV2VjHr_CALkT6Hgb9w/viewform?embedded=true" width="100%" frameborder="0" marginheight="0" marginwidth="0" style="height:100%">Cargando‚Ä¶</iframe>
                    <p style="font-size: 0.8em; color: #666;">Formulario de Google Forms. Tus respuestas se env√≠an directamente a nuestro sistema.</p>
                    <div style="margin-top:10px; text-align:right;">
                        <button class="btn" onclick="openFullscreenIframe('iframe-trial','Formulario de Solicitud de Trial')">Abrir a pantalla completa</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="roi">
        <h2 class="section-title">Calculadora de ROI Integral</h2>
        <p>Ingresa tu presupuesto estimado y calcula el retorno potencial (cine + software). Ver√°s un desglose visual de c√≥mo se llega al resultado.</p>
        <div class="card">
            <label>Presupuesto (USD): <input type="number" id="budget" placeholder="50000"></label><br><br>
            <button class="btn" onclick="calculateROI()">Calcular ROI</button>
            <button class="btn" onclick="clearROI()" style="background: #666; margin-left: 10px;">Limpiar</button>
            <div id="breakdown" style="display: none; margin-top: 20px;">
                <h4>Desglose del C√°lculo</h4>
                <p><strong>Costos Iniciales:</strong> <span id="costs"></span></p>
                <p><strong>Beneficios Tangibles (Ventas + Ingresos):</strong> <span id="tangible"></span></p>
                <p><strong>Beneficios Intangibles (Reputaci√≥n + Alcance):</strong> <span id="intangible"></span></p>
                <div style="background: #f4f4f4; padding: 10px; border-radius: 5px;">
                    <p><strong>Total Beneficios:</strong> <span id="totalBenefits"></span></p>
                    <p><strong>ROI Final:</strong> <span id="roiResult"></span></p>
                    <div style="width: 100%; background: #ddd; height: 20px; border-radius: 10px; margin-top: 10px;">
                        <div id="roiBar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #FFD700); border-radius: 10px; width: 0%; transition: width 1s;"></div>
                    </div>
                    <p style="font-size: 0.8em; color: #666;">Barra visual del ROI (ancho representa el porcentaje)</p>
                </div>
            </div>
        </div>
    </section>

    <footer id="contacto">
        <p>Contacto: dominionnatura@gmail.com | ¬© 2025 Identidad de Territorio</p>
        <p>S√≠guenos en redes sociales para m√°s inspiraci√≥n.</p>
    </footer>

    <!-- Modal overlay for fullscreen forms -->
    <div id="modal-overlay" class="modal-overlay" role="dialog" aria-hidden="true">
        <div class="modal-content" role="document">
            <button class="modal-close" aria-label="Cerrar formulario" onclick="closeModal()">‚úï</button>
            <iframe id="modal-iframe" title="Formulario en pantalla completa"></iframe>
        </div>
    </div>

    <script>
        // Animaci√≥n simple al scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section');
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top < window.innerHeight - 100) {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }
            });
        });

        // Inicializar opacidad
        document.querySelectorAll('section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            section.style.transition = 'opacity 0.5s, transform 0.5s';
        });

        function toggleAccordion(id, headerEl) {
            const content = document.getElementById(id);
            if (!content) return;
            // Determine open state via maxHeight (we use max-height animation)
            const currentMax = content.style.maxHeight && content.style.maxHeight !== '0px';
            const isOpen = !!currentMax;

            // Close all other accordion contents (autoclose behavior)
            document.querySelectorAll('.accordion-content').forEach(c => {
                if (c.id !== id) {
                    c.style.maxHeight = '0px';
                    const hdr = document.querySelector('.accordion-header[aria-controls="' + c.id + '"]');
                    if (hdr) {
                        hdr.classList.remove('open');
                        hdr.setAttribute('aria-expanded', 'false');
                    }
                }
            });

                if (!isOpen) {
                    // Open this one: set maxHeight to a capped value (viewport-based) for mobile friendliness
                    const viewportLimit = Math.round(window.innerHeight * 0.75); // 75% of viewport
                    const desired = Math.min(content.scrollHeight, viewportLimit);
                    content.style.maxHeight = desired + 'px';
                    content.style.padding = '14px 0 0 0';
                    content.style.opacity = '1';
                    if (headerEl && headerEl.classList) {
                        headerEl.classList.add('open');
                        headerEl.setAttribute('aria-expanded', 'true');
                    }
            } else {
                // Close it
                    content.style.maxHeight = '0px';
                    content.style.padding = '0';
                    content.style.opacity = '0';
                    if (headerEl && headerEl.classList) {
                        headerEl.classList.remove('open');
                        headerEl.setAttribute('aria-expanded', 'false');
                    }
            }
        }

        // Add keyboard accessibility for accordion headers (Enter / Space)
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.accordion-header').forEach(h => {
                h.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleAccordion(this.getAttribute('aria-controls'), this);
                    }
                });
            });
        });

        // Fullscreen modal controls for iframes
        async function openFullscreenIframe(iframeId, title) {
            const src = document.getElementById(iframeId).getAttribute('src');
            const modal = document.getElementById('modal-overlay');
            const modalIframe = document.getElementById('modal-iframe');
            const modalContent = document.querySelector('.modal-content');
            modalIframe.setAttribute('src', src);
            modalIframe.setAttribute('title', title || 'Formulario');
            modal.classList.add('open');
            modal.setAttribute('aria-hidden', 'false');
            // trap focus to modal and focus close button
            document.querySelector('.modal-close').focus();
            // prevent body scroll
            document.body.style.overflow = 'hidden';
            // enable focus trap and hide main content from AT
            enableFocusTrap(modalContent);

            // Try to enter native fullscreen for supported browsers
            try {
                if (modalContent.requestFullscreen) {
                    await modalContent.requestFullscreen({ navigationUI: 'hide' });
                } else if (modalContent.webkitRequestFullscreen) { // Safari
                    modalContent.webkitRequestFullscreen();
                } else if (modalContent.msRequestFullscreen) {
                    modalContent.msRequestFullscreen();
                }
            } catch (err) {
                // If fullscreen is blocked or fails, we silently continue with modal overlay
                console.info('Fullscreen request failed or was blocked:', err);
            }
        }

        async function closeModal() {
            const modal = document.getElementById('modal-overlay');
            const modalIframe = document.getElementById('modal-iframe');
            modalIframe.setAttribute('src', '');
            // If in fullscreen, exit it first
            try {
                if (document.fullscreenElement) {
                    await document.exitFullscreen();
                } else if (document.webkitFullscreenElement) {
                    document.webkitExitFullscreen && document.webkitExitFullscreen();
                }
            } catch (err) {
                console.info('Error exiting fullscreen:', err);
            }
            modal.classList.remove('open');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            // restore aria-hidden and focus
            restorePageAccessibility();
            disableFocusTrap();
        }

        // Close modal with ESC key or clicking outside
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('modal-overlay');
                if (modal.classList.contains('open')) closeModal();
            }
        });
        document.getElementById('modal-overlay').addEventListener('click', (e) => {
            if (e.target.id === 'modal-overlay') closeModal();
        });

        // Focus-trap implementation: keep focus inside modal while open
        let focusTrapHandler = null;
        let previouslyFocused = null;
        function enableFocusTrap(modal) {
            previouslyFocused = document.activeElement;
            const focusableSelectors = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, [tabindex]:not([tabindex="-1"])';
            const focusable = Array.from(modal.querySelectorAll(focusableSelectors)).filter(el => el.offsetParent !== null);
            const first = focusable[0];
            const last = focusable[focusable.length -1];

            focusTrapHandler = function(e) {
                if (e.key === 'Tab') {
                    if (focusable.length === 0) {
                        e.preventDefault();
                        return;
                    }
                    if (e.shiftKey) { // shift + tab
                        if (document.activeElement === first) {
                            e.preventDefault();
                            last.focus();
                        }
                    } else { // tab
                        if (document.activeElement === last) {
                            e.preventDefault();
                            first.focus();
                        }
                    }
                }
            };
            document.addEventListener('keydown', focusTrapHandler);
            // hide main page from assistive tech
            setPageAccessibilityHidden(true);
        }

        function disableFocusTrap() {
            if (focusTrapHandler) {
                document.removeEventListener('keydown', focusTrapHandler);
                focusTrapHandler = null;
            }
            if (previouslyFocused && previouslyFocused.focus) previouslyFocused.focus();
        }

        function setPageAccessibilityHidden(hidden) {
            // add aria-hidden to main page elements to hide them from screen readers
            document.querySelectorAll('header, main, section, footer, nav').forEach(el => {
                if (hidden) el.setAttribute('aria-hidden', 'true'); else el.removeAttribute('aria-hidden');
            });
        }

        function restorePageAccessibility() {
            setPageAccessibilityHidden(false);
        }

        // ROI calculator: show breakdown with animation and simple counter
        function calculateROI() {
            const budgetInput = document.getElementById('budget').value;
            const budget = parseFloat(budgetInput) || 0;
            
            // Validaci√≥n de entrada
            if (budget <= 0) {
                alert('Por favor ingresa un presupuesto v√°lido mayor a 0');
                return;
            }
            
            if (budget > 10000000) {
                alert('El presupuesto ingresado es muy alto. Por favor usa un valor m√°s realista.');
                return;
            }
            
            const breakdown = document.getElementById('breakdown');
            const costsEl = document.getElementById('costs');
            const tangibleEl = document.getElementById('tangible');
            const intangibleEl = document.getElementById('intangible');
            const totalEl = document.getElementById('totalBenefits');
            const roiEl = document.getElementById('roiResult');
            const roiBar = document.getElementById('roiBar');

            // Simple model assumptions - usando n√∫meros m√°s conservadores
            const costs = Math.round(budget);
            const tangible = Math.round(budget * 1.4); // Reducido de 1.6 a 1.4
            const intangible = Math.round(budget * 0.6); // Reducido de 0.8 a 0.6
            const totalBenefits = tangible + intangible;
            const roiPercent = costs > 0 ? Math.round(((totalBenefits - costs) / costs) * 100) : 0;

            breakdown.style.display = 'block';
            // animate reveal
            breakdown.style.opacity = '0';
            breakdown.style.transform = 'translateY(10px)';
            setTimeout(() => {
                breakdown.style.transition = 'opacity 0.5s, transform 0.5s';
                breakdown.style.opacity = '1';
                breakdown.style.transform = 'translateY(0)';
            }, 20);

            // animate numeric counters (simple)
            animateNumber(costsEl, 0, costs, 700);
            animateNumber(tangibleEl, 0, tangible, 700);
            animateNumber(intangibleEl, 0, intangible, 700);
            animateNumber(totalEl, 0, totalBenefits, 700);
            animateNumber(roiEl, 0, roiPercent, 700, '%');

            // animate bar width (cap between 0 and 200 for visual)
            const barPct = Math.max(0, Math.min(200, roiPercent));
            setTimeout(() => { roiBar.style.width = Math.min(100, barPct) + '%'; }, 100);
        }

        function animateNumber(el, start, end, duration, suffix = '') {
            // Prevenir animaci√≥n si el n√∫mero es muy grande para evitar que se "dispare"
            if (Math.abs(end - start) > 10000) {
                el.textContent = end.toLocaleString() + suffix;
                return;
            }
            
            const range = end - start;
            const steps = Math.min(50, Math.abs(range)); // Limitar pasos m√°ximos a 50
            const stepTime = Math.max(20, Math.floor(duration / steps));
            const stepSize = range / steps;
            let current = start;
            let stepCount = 0;
            
            const timer = setInterval(() => {
                stepCount++;
                current = start + (stepSize * stepCount);
                
                if (stepCount >= steps) {
                    clearInterval(timer);
                    el.textContent = end.toLocaleString() + suffix;
                } else {
                    el.textContent = Math.round(current).toLocaleString() + suffix;
                }
            }, stepTime);
        }

        // Funci√≥n para limpiar/borrar el c√°lculo de ROI
        function clearROI() {
            // Limpiar el input
            document.getElementById('budget').value = '';
            
            // Ocultar el desglose
            const breakdown = document.getElementById('breakdown');
            breakdown.style.display = 'none';
            
            // Limpiar todos los valores
            document.getElementById('costs').textContent = '';
            document.getElementById('tangible').textContent = '';
            document.getElementById('intangible').textContent = '';
            document.getElementById('totalBenefits').textContent = '';
            document.getElementById('roiResult').textContent = '';
            
            // Reset barra visual
            const roiBar = document.getElementById('roiBar');
            roiBar.style.width = '0%';
            
            // Remover transiciones para reset limpio
            breakdown.style.transition = 'none';
            breakdown.style.opacity = '0';
            breakdown.style.transform = 'translateY(10px)';
        }
    </script>
</body>
</html>
